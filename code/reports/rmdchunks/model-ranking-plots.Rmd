```{r, results = 'asis'}
library(forcats)

lookup_variables <- names(target_variables)
names(lookup_variables) <- target_variables
skill_table <- table %>%
  mutate(variable = lookup_variables[target_variable])

## select best individual models
selected <- skill_table %>%
  ## FIXME: do we need a better way to identify hub models?
  filter(!is.na(rel_wis), !grepl("hub-(ensemble|baseline)$", model)) %>%
  arrange(location_name, target_variable, horizon, rel_wis) %>%
  group_by(location_name, target_variable, horizon) %>%
  slice(1) %>%
  ungroup() %>%
  mutate(model = "Best individual model")

## if not doing the ensemble, select the ensemble
if (!grepl("hub-ensemble$", params$model)) {
  ensemble <- skill_table %>%
    filter(grepl("hub-ensemble$", model))
  selected <- selected %>%
    rbind(ensemble)
}

df <- skill_table %>%
  filter(model == params$model) %>%
  bind_rows(selected, .) %>%
  filter(!is.na(rel_wis)) %>%
  mutate(location_name = fct_rev(location_name))

ggplot(df, aes(x = location_name, y = rel_wis, colour = model)) +
  facet_grid(variable ~ horizon, scales = "free") +
  geom_point() +
  scale_colour_brewer("", palette = "Set2") +
  geom_hline(yintercept = 1, linetype = "dashed") +
  theme_clean() +
  xlab("") + ylab("Relative skill") +
  coord_flip()

```
